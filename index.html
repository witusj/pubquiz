<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pub Quiz App</title>
    <!-- Tailwind CSS CDN with Dark Mode Configuration -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {},
            },
            variants: {
                extend: {},
            },
            plugins: [],
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- MathJax CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        /* Custom styles for the timer transition */
        .timer-transition {
            transition: width 1s linear;
        }
        /* Responsive iframe container */
        .iframe-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 */
            height: 0;
            overflow: hidden;
            border-radius: 0.5rem;
        }
        .iframe-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 min-h-screen flex items-center justify-center p-4">
    
    <!-- Dark Mode Toggle Button -->
    <button id="darkModeToggle" class="absolute top-4 right-4 px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Toggle Dark Mode">
        Toggle Dark Mode
    </button>

    <div class="max-w-3xl w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6 flex flex-col h-full md:h-[80vh] relative">
        <!-- Timer Bar -->
        <div class="w-full h-4 bg-gray-300 dark:bg-gray-600 rounded overflow-hidden mb-2">
            <div id="timer" class="h-full bg-green-500 timer-transition" style="width: 100%;"></div>
        </div>

        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mb-4">
            <div id="progressBar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%;"></div>
        </div>

        <!-- Progress Indicator -->
        <div id="progressIndicator" class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
            <!-- Progress will be displayed here -->
        </div>

        <!-- Question and Media Container -->
        <div class="flex-1 overflow-auto mb-4">
            <!-- Question Area -->
            <div id="questionArea" class="mb-4">
                <!-- Question will be displayed here -->
            </div>

            <!-- Media Content -->
            <div id="mediaContent" class="mb-4">
                <!-- Media (image/video/text/youtube) will be displayed here -->
            </div>
        </div>

        <!-- Category Footer -->
        <div id="category" class="text-right text-sm font-medium text-gray-600 dark:text-gray-400 mb-4">
            <!-- Category will be displayed here -->
        </div>

        <!-- Navigation Controls -->
        <div class="flex justify-between mt-auto">
            <button id="prevBtn" class="px-4 py-2 bg-blue-500 dark:bg-blue-700 text-white rounded hover:bg-blue-600 dark:hover:bg-blue-800 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Previous Question">
                Previous
            </button>
            <button id="nextBtn" class="px-4 py-2 bg-blue-500 dark:bg-blue-700 text-white rounded hover:bg-blue-600 dark:hover:bg-blue-800 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Next Question">
                Next
            </button>
        </div>
    </div>

    <script>
        // Sample Questions Data
        const questions = [
            {
                question: "Tot welke diersoort behoren deze planten?",
                category: "Wetenschap",
                media: {
                    type: "image",
                    src: "https://github.com/witusj/pubquiz/blob/main/images/flowers.png?raw=true",
                    alt: "Flowers"
                },
                time: 20 // seconds
            },
            {
                question: "Welke Star Wars acteur is dit jaar overleden en welk personage speelde hij?",
                category: "Entertainment",
                media: {
                    type: "image",
                    src: "https://github.com/witusj/pubquiz/blob/main/images/starwars.png?raw=true",
                    alt: "Flowers"
                },
                time: 20 // seconds
            },
            {
                question: "Hoeveel is x<sup>2</sup> + y<sup>2</sup> in dit geval?",
                category: "Wetenschap",
                media: {
                    type: "image",
                    src: "https://github.com/witusj/pubquiz/blob/main/images/pythogoras.png?raw=true",
                    alt: "Pythagoras"
                },
                time: 15 // seconds
            },
            {
                question: "Welk liedje wordt hier vakkundig gecoverd?",
                category: "Entertainment",
                media: {
                    type: "youtube",
                    src: "https://www.youtube.com/embed/AqbM1ZDMJeI?autoplay=1" // Removed autoplay=1
                },
                time: 20
            },
            {
                question: "Van wie is deze uitspraak?",
                category: "Geschiedenis",
                media: {
                    type: "text",
                    content: "De manier waarop we leven verschilt zo van de manier waarop we zouden moeten leven dat hij die bestudeert wat er gedaan moet worden in plaats van wat er gedaan wordt, de weg naar zijn ondergang zal leren in plaats van naar zijn behoud.<hr class='m-10'>Il modo in cui viviamo è così diverso da come dovremmo vivere che colui che studia ciò che dovrebbe essere fatto piuttosto che ciò che viene fatto imparerà la strada per la sua rovina piuttosto che per la sua conservazione."
                },
                time: 20
            }
        ];

        let currentQuestionIndex = 0;
        let timerInterval;
        let timeLeft;

        const questionArea = document.getElementById('questionArea');
        const mediaContent = document.getElementById('mediaContent');
        const category = document.getElementById('category');
        const timerBar = document.getElementById('timer');
        const progressBar = document.getElementById('progressBar');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const progressIndicator = document.getElementById('progressIndicator');
        const darkModeToggle = document.getElementById('darkModeToggle');

        // Dark Mode Toggle Functionality
        darkModeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
        });

        function loadQuestion(index) {
            clearInterval(timerInterval);
            const questionObj = questions[index];
            if (!questionObj) return;

            // Update Progress Indicator
            progressIndicator.textContent = `Question ${index + 1} of ${questions.length}`;

            // Update Progress Bar
            const progressPercentage = ((index + 1) / questions.length) * 100;
            progressBar.style.width = `${progressPercentage}%`;

            // Display Question
            questionArea.innerHTML = `
                <h2 class="text-2xl font-bold mb-2 text-gray-800 dark:text-gray-100">Q${index + 1}: ${questionObj.question}</h2>
            `;

            // Trigger MathJax typesetting after inserting the question
            MathJax.typesetPromise();

            // Display Media
            mediaContent.innerHTML = ''; // Clear previous media
            if (questionObj.media) {
                if (questionObj.media.type === 'image') {
                    const img = document.createElement('img');
                    img.src = questionObj.media.src;
                    img.alt = questionObj.media.alt || 'Image';
                    img.className = "w-full h-auto rounded mb-4";
                    mediaContent.appendChild(img);
                } else if (questionObj.media.type === 'video') {
                    const video = document.createElement('video');
                    video.src = questionObj.media.src;
                    video.controls = true;
                    video.className = "w-full h-auto rounded mb-4";
                    mediaContent.appendChild(video);
                } else if (questionObj.media.type === 'text') {
                    const p = document.createElement('p');
                    p.innerHTML = questionObj.media.content;
                    p.className = "text-gray-700 dark:text-gray-300 mb-4";
                    mediaContent.appendChild(p);
                } else if (questionObj.media.type === 'youtube') {
                    const iframeContainer = document.createElement('div');
                    iframeContainer.className = "iframe-container mb-4";
                    const iframe = document.createElement('iframe');
                    iframe.src = questionObj.media.src;
                    iframe.title = "YouTube video player";
                    iframe.frameBorder = "0";
                    iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen";
                    iframe.allowFullscreen = true;
                    iframeContainer.appendChild(iframe);
                    mediaContent.appendChild(iframeContainer);
                } else {
                    // Handle unrecognized media types gracefully
                    const p = document.createElement('p');
                    p.textContent = "Unsupported media type.";
                    p.className = "text-red-500 dark:text-red-400 mb-4";
                    mediaContent.appendChild(p);
                }
            }

            // Display Category
            category.textContent = `Category: ${questionObj.category}`;

            // Initialize Timer
            timeLeft = questionObj.time;
            timerBar.style.width = '100%';
            // Reset timer bar color to green
            timerBar.classList.remove('bg-red-500', 'bg-yellow-500');
            timerBar.classList.add('bg-green-500');
            timerInterval = setInterval(updateTimer, 1000);

            // Disable Previous button on first question
            prevBtn.disabled = index === 0;
            // Disable Next button on last question
            if (index === questions.length - 1) {
                nextBtn.disabled = false; // Allow proceeding to completion
            } else {
                nextBtn.disabled = false;
            }
        }

        function updateTimer() {
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                // Change timer bar color to red to indicate time is up
                timerBar.classList.remove('bg-green-500', 'bg-yellow-500');
                timerBar.classList.add('bg-red-500');
                return;
            }
            timeLeft--;
            const percentage = (timeLeft / questions[currentQuestionIndex].time) * 100;
            timerBar.style.width = `${percentage}%`;

            // Optional: Change timer bar color as time decreases
            if (timeLeft <= 5) { // Last 5 seconds
                timerBar.classList.remove('bg-green-500');
                timerBar.classList.add('bg-yellow-500');
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion(currentQuestionIndex);
            } else {
                displayCompletionMessage();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion(currentQuestionIndex);
            }
        }

        function displayCompletionMessage() {
            clearInterval(timerInterval);
            // Hide quiz elements and display completion message
            document.querySelector('.max-w-3xl').innerHTML = `
                <h2 class="text-3xl font-bold text-center mb-4 text-gray-800 dark:text-gray-100">Quiz Completed!</h2>
                <p class="text-center text-lg text-gray-700 dark:text-gray-300">Thank you for participating!</p>
                <button id="restartQuiz" class="mt-6 px-4 py-2 bg-blue-500 dark:bg-blue-700 text-white rounded hover:bg-blue-600 dark:hover:bg-blue-800 mx-auto block focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Restart Quiz">
                    Restart Quiz
                </button>
            `;

            // Add Event Listener to Restart Button
            const restartQuizBtn = document.getElementById('restartQuiz');
            if (restartQuizBtn) {
                restartQuizBtn.addEventListener('click', () => {
                    location.reload();
                });
            }
        }

        // Event Listeners for Navigation Buttons
        nextBtn.addEventListener('click', nextQuestion);
        prevBtn.addEventListener('click', prevQuestion);

        // Initialize First Question
        loadQuestion(currentQuestionIndex);
    </script>

</body>
</html>
